其他数据设计与算法
==================

计步器程序不光要提供用户运动时的步数，而且要能够提供其他一些相应的信息，
如里程、步速、时速以及所消耗的热量。用户可以参考这些这些数据来实时调整运
动情况，以达到最佳锻炼效果。

根据上一章的分析，我们已经可以得到较为精确的计步数据，在计步数据已知的情
况下，就可以较为方便地计算出我们所感兴趣的信息。

里程计算
--------

里程计算框图如图 \ref{ch5distancecal} 所示。

![里程计算框图\label{ch5distancecal}](media/ch5distancecal.pdf)

其中步长是由用户设置，其默认值为 \SI{50}{\centi\meter}。通过步数与步长的
乘积即可得出大致的里程。

步速、时速的计算 {#sectionspeed}
----------------

步速和时速的计算涉及到手机系统时间 (格式为：时.分.秒.毫秒)，即由单位时间
内所运动的步数和里程得出。如图 \ref{ch5speedcal} 所示，为步速、时速设计
框图。框图设计的总体思想是：通过得出的手机系统时间，计算出相隔固定时间
$T$ 内所运动的步数差值 $\Delta S$，则 $\Delta S / T$ 即为步速，
再由步长即可得出时速。

![步速、时速设计框图\label{ch5speedcal}](media/ch5speedcal.pdf)

热量计算
--------

热量的计算是非常复杂的，且没有固定公式，程序中只能估计运动所消耗的热量。
以下给出几种运动消耗卡路里的计算方式(参考网页：
<http://www.boohee.com/assessment/activity_calory>)：

(1) 已知体重 $m$ 千克、时间 $t$ 小时，速度 $v$ (分钟/400 米)，则跑步消耗
    热量 $W$(kcal) 为：

    $W = m \times t \times k$

    式中，$k$ 为运动指数，$k = 30 \div v$。

(2) 已知体重 $m$ 千克、距离 $s$ 千米，则

    $W = m \times s \times 1.036$

(3) 已知体重 $m$ 千克、速度和时间 (分钟)，则

    $W = m \times t \times k$

    式中，$k$ 为运动指数，其具体数值见表 \ref{ch5tablek}

\begin{table}[htbp]
    \caption{运动指数 $k$ 与速度的关系}
    \label{ch5tablek} \centering
    \begin{tabular}{l l l l}
    \\
    \toprule
    运动速度    & 每小时 8 千米 & 每小时 12 千米    & 每小时 15 千米 \\
    $k$         & 0.1355        & 0.1797            & 0.1875 \\
    \bottomrule
    \end{tabular}
\end{table}

需要指出的是，以上公式都很粗略，因为它们忽视了年龄、性别、体质和基础代谢
率等因素，只是给大家提供一个参考。在计步器程序设计中采用第一种计算方法，
其具体设计框图如图 \ref{ch5calcal} 所示。

![运动消耗热量计算框图\label{ch5calcal}](media/ch5calcal.pdf)

图中运动指数 $k$ 的数值经方法 (1) 换算成 $1.25 \times$ 时速 (千米/小时)，时速的
数值已由第 \ref{sectionspeed} 节中介绍的方法求得。

通过以上各种算法，将步数作为中间变量间接求出其他信息。因此，必须在计步数
据相对精确的情况下才有实际参考意义。另外，由于程序中设计的延时参数 $T$
较大(若 $T$ 较小，则难以捕捉到短时间内的步数，有可能造成一段时间内速度始
终为 0 的情况)，界面显示有一定的延时，但不会影响程序的正确运行。
